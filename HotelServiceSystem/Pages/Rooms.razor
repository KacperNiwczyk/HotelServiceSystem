@page "/rooms"
@using HotelServiceSystem.Interfaces.Services
@using HotelServiceSystem.Entities
@using HotelServiceSystem.Core.Components
@inject IRoomService roomService

<h3>Rooms</h3>
<div class="col-12">
    <hr/>
    <EditForm Model="@ModelRoom" OnValidSubmit="@SaveRoom">
        <HssInputCustom Caption="Room identifier" @bind-Value="ModelRoom.RoomIdentifier"/>
        <HssInputCustom Caption="Floor" @bind-Value="ModelRoom.Floor" />
        <HssInputCustom Caption="Number of beds" @bind-Value="ModelRoom.NumberOfBeds"/>
        <HssInputCustom Caption="Capacity of guests" @bind-Value="ModelRoom.GuestsCapacity"/>
        <HssInputCustom Caption="Price" @bind-Value="ModelRoom.Price"/>
        <div class="col-12 row">
            <span class="col-2"></span>
            <input type="submit" class="form-control col-1 btn btn-primary" value="Submit"/>
        </div>
    </EditForm>
    
    <div class="col-10">
        <h3>Rooms</h3>
        <table class="table">
            <thead>
            <tr>
                <th>Room number</th>
                <th>Capacity</th>
                <th>Number of beds</th>
                <th>Floor</th>
                <th>Price</th>
                <th>Is free?</th>
                <th>Is out of service?</th>
                <th>Need cleaning?</th>
            </tr>
            </thead>
            <tbody>
            @if (RoomList != null)
            {
                foreach (var room in RoomList)
                {
                    <tr>
                        <td>@room.RoomIdentifier</td>
                        <td>@room.GuestsCapacity</td>
                        <td>@room.NumberOfBeds</td>
                        <td>@room.Floor</td>
                        <td>@room.Price</td>
                        <td>@room.IsFree</td>
                        <td>@room.IsOutOfService</td>
                        <td>@room.ShouldBeCleaned</td>
                    </tr>
                }
            }
            else
            {
                <h3>..Loading</h3>
            }
            </tbody>
        </table>
    </div>
</div>

@code {
    private List<Room> RoomList { get; set; }
    private Room ModelRoom { get; set; }

    protected override async Task OnInitializedAsync()
    {
        ModelRoom = SetNewRoom();
        RoomList = roomService.GetAllRoomsAsync();
        await base.OnInitializedAsync();
    }

    private async Task SaveRoom()
    {
        await roomService.AddRoomAsync(ModelRoom);
        RoomList.Add(ModelRoom);
        ModelRoom = SetNewRoom();
    }

    private Room SetNewRoom()
    {
        return new Room()
        {
            RoomReservations = new List<RoomReservation>(),
            IsFree = true,
            IsOutOfService = false,
            ShouldBeCleaned = false
        };
    }
}